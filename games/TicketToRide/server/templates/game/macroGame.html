{% macro socketGame(prefix) %}
<script type="text/javascript">
    {% include "game/maps_images.js" %}

    var canvas = document.getElementById('game_canvas');
    var ctx = canvas.getContext('2d');

    /**
     * Draw a <color> rectangle centered on <pos>, and rotated <angle> degrees.
     **/
    function drawRectangle(pos, angle, color) {
        ctx.save();

        ctx.fillStyle = color;
        ctx.translate(pos[0], pos[1]);
        ctx.rotate(angle * Math.PI / 180);
        ctx.fillRect(-7, -20, 13, 40);

        ctx.restore();
    }

    function onImageLoad() {
    }

    /* function run by Game.html and Player.html */
    function updateWebSocket(){
        /* when received update about a Game, just display it */
        socket.on('update{{ GameName }}', function (msg) {
            var data = JSON.parse(msg);

            // load image only first time
            if (data.hasOwnProperty('map_name')) {
                let map_bg = new Image();
                map_bg.onload = function () {
                    canvas.setAttribute("width", maps[data['map_name']].width);
                    canvas.setAttribute("height", maps[data['map_name']].height);
                    ctx.drawImage(map_bg, 0, 0, canvas.getAttribute('width'), canvas.getAttribute('height'));

                    // draw all rectangles (only for testing)
                    for (let key in data.coordinates.tracks) {
                        if (data.coordinates.tracks.hasOwnProperty(key)) {
                            let rect_list = data.coordinates.tracks[key];
                            for (let i = 0; i < rect_list.length; i++) {
                                let rect = rect_list[i];
                                drawRectangle(rect[0], rect[1], "blue");
                            }
                        }
                    }
                    onImageLoad();
                }
                map_bg.src = maps[data['map_name']].data;
            }
        });
    }
    /* register to endOfGame and display it when received*/
    function displayEndOfGame(){
        socket.on('endOfGame', function(msg){
            document.getElementById('endOfGame').innerHTML = msg;
        });
    }
</script>
{% endmacro %}

{% macro styleGame() %}
{% endmacro %}

{% macro contentGame() %}
<div id="game_content">
    <canvas style="display:block; margin: 25px auto; width: 75%;" id="game_canvas">
    </canvas>
</div>
{% endmacro %}